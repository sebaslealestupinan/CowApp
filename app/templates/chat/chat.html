{% extends "base.html" %}

{% block title %}Chat{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/chat.css">
{% endblock %}

{% block content %}

<div class="chat-wrapper">

    <!-- Encabezado -->
    <div class="chat-header">
        <!-- Avatar placeholder (opcional) -->
        <div
            style="width: 40px; height: 40px; background: #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; margin-right: 10px;">
            {{ receiver_name[0] | upper }}
        </div>
        <div>
            <h2>{{ receiver_name }}</h2>
            <div class="status">en l√≠nea</div>
        </div>
    </div>

    <!-- Contenedor de mensajes -->
    <div id="message-list" class="chat-messages" data-sender-id="{{ sender_id }}" data-receiver-id="{{ receiver_id }}"
        data-receiver-name="{{ receiver_name }}"></div>

    <!-- Zona de escritura -->
    <div class="chat-input-container">
        <!-- Icono de emoji (opcional, solo visual por ahora) -->
        <button type="button">
            <svg viewBox="0 0 24 24" width="24" height="24" class="">
                <path fill="currentColor"
                    d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10zm-3.5-8c.828 0 1.5-.672 1.5-1.5S9.328 11 8.5 11 7 11.672 7 12.5 7.672 14 8.5 14zm7 0c.828 0 1.5-.672 1.5-1.5S16.328 11 15.5 11 14 11.672 14 12.5 14.672 14 15.5 14zm-3.5 3.5c2.347 0 4.276-1.566 4.868-3.75H7.132c.592 2.184 2.521 3.75 4.868 3.75z">
                </path>
            </svg>
        </button>

        <textarea id="message-input" placeholder="Escribe un mensaje" rows="1"></textarea>

        <button id="send-btn">
            <svg viewBox="0 0 24 24" width="24" height="24" class="">
                <path fill="currentColor"
                    d="M1.101 21.757 23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"></path>
            </svg>
        </button>
    </div>

</div>

<!-- Variables globales simples, limpias y JSON-safe -->
<script>
    window.CHAT_CONFIG = {
        senderId: {{ sender_id | tojson }},
    receiverId: { { receiver_id | tojson } },
    receiverName: { { receiver_name | tojson } },
    wsUrl: (window.location.protocol === "https:" ? "wss://" : "ws://")
        + window.location.host
        + "/chat/ws/{{ sender_id }}"
    };
</script>

<script src="/static/js/chat.js"></script>

{% endblock %}