<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/chat.css') }}">
</head>

<body>
    <input type="hidden" id="user_id" value="{{ user_id }}">
    <div id="chat-container">
        <h1>Que vamos a hablar?</h1>

        <div id="messages">
            {% for msg in mensajes %}
            <div class="msg">{{ msg.texto }}</div>
            {% endfor %}
        </div>

        <div id="input-area">
            <input id="messageInput" type="text" placeholder="Que quieres decir...">
            <button id="sendBtn">Send</button>
        </div>
    </div>

    <script>
        const userId = document.getElementById("user_id").value;
        const ws = new WebSocket("ws://" + window.location.host + "/ws/chat?user_id=" + userId);

        const messagesDiv = document.getElementById("messages");
        const input = document.getElementById("messageInput");
        const sendBtn = document.getElementById("sendBtn");

        ws.onmessage = function (event) {
            const div = document.createElement("div");
            div.classList.add("msg");
            div.innerText = event.data;
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        };

        sendBtn.onclick = enviar;
        input.onkeypress = (e) => { if (e.key === "Enter") enviar(); };

        function enviar() {
            if (input.value.trim() !== "") {
                // CORREGIDO 2: Solo enviar el contenido en el JSON
                ws.send(JSON.stringify({
                    content: input.value // <-- Â¡Solo el contenido!
                }));
                input.value = "";
            }
        }
    </script>
</body>

</html>